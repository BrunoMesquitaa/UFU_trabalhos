---
title: "Ultimo Trabalho Regressao"
author: "Bruno Mesquita dos Santos"
date: "2023-11-15"
output:
  word_document: default
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Biblioteca

```{r}
if (!require('readr'))install.packages("readr");library(readr)
if (!require('faraway'))install.packages("faraway");library(faraway)
if (!require('car'))install.packages("car");library(car)
if (!require('olsrr'))install.packages("olsrr");library(olsrr)
if (!require('DescTools'))install.packages("DescTools");library(DescTools)
```

# Dados Consumo Cerveja

```{r}
Consumo_cerveja <- read_csv("dados/Consumo_cerveja.csv",   
                            locale = locale(decimal_mark = ","))
```

# Fun√ß√µes

```{r}
rm_accent <- function(x) iconv(x, to = "ASCII//TRANSLIT")
```

# Limpeza

```{r}
names(Consumo_cerveja) <- tolower(
  gsub(' ','_',gsub('[)]','',gsub('[(]','',rm_accent(names(Consumo_cerveja)))))
  )
Consumo_cerveja <- na.omit(Consumo_cerveja)
```

# Separar Bases

```{r}
data <- Consumo_cerveja$data
temperatura_media_c <- Consumo_cerveja$temperatura_media_c
temperatura_minima_c <- Consumo_cerveja$temperatura_minima_c
temperatura_maxima_c <- Consumo_cerveja$temperatura_maxima_c
precipitacao_mm <- Consumo_cerveja$precipitacao_mm
final_de_semana <- Consumo_cerveja$final_de_semana
consumo_de_cerveja_litros <- Consumo_cerveja$consumo_de_cerveja_litros
```

# An√°lise de Regress√£o

## Quest√£o A

Ajuste um modelo de regress√£o linear m√∫ltipla considerando todas as vari√°veis independentes. Verifique a multicolinearidade entre as vari√°veis independentes, e se h√° necessidade de excluir alguma delas por esse crit√©rio. Em caso afirmativo, ajuste novo modelo sem essa vari√°vel. Apresente todos os valores de Vif.

```{r}
modelo_completo = lm(consumo_de_cerveja_litros ~ data+temperatura_media_c+
                       temperatura_minima_c+temperatura_maxima_c+
                       precipitacao_mm+final_de_semana)

summary(modelo_completo)
summary(aov(modelo_completo))
```

### Anotac√£o:

Se o VIF for igual a 1 n√£o h√° multicolinearidade entre os fatores, mas se o VIF for maior que 1, as preditoras podem estar moderadamente correlacionadas. A sa√≠da acima mostra que o VIF para os fatores de publica√ß√£o e anos s√£o cerca de 1.5, o que indica alguma correla√ß√£o, mas n√£o o suficiente para se preocupar demais com isso. Um VIF entre 5 e 10 indica alta correla√ß√£o, o que pode ser problem√°tico. E se o VIF for acima de 10, voc√™ pode assumir que os coeficientes de regress√£o est√£o mal estimados devido √† multicolinearidade.

### VIF:

```{r}
vif <- 1/(1-summary(modelo_completo)[["r.squared"]])
paste('vif =',vif)
```

Com rela√ß√£o ao nosso modelo temos um VIF para o modelo completo de 3.7254 o que quer dizer que ele √© moderadamente correlacionadas.

```{r}
vif(modelo_completo)
```

Por√©m quando vamos para um VIF mais detalhado temos em temperatura_media_c, temperatura_minima_c, temperatura_maxima_c uma multicolinearidade alto, o que faz sentido devido serem dados de temperaturas tendo a mesmas representatividade, logo removeria dois ficando √© com a temperatura_media_c.

### Removendo a multicolinearidade

```{r}
modelo_completo = lm(consumo_de_cerveja_litros ~ data+temperatura_media_c+
                       precipitacao_mm+final_de_semana)

summary(modelo_completo)
summary(aov(modelo_completo))
```

### Conclus√£o:

```{r}
vif <- 1/(1-summary(modelo_completo)[["r.squared"]])
paste('vif =',vif)
```

Com rela√ß√£o ao nosso modelo temos um VIF para o modelo completo de 3.058 o que quer dizer que ele √© moderadamente correlacionadas.

```{r}
vif(modelo_completo)
```

Por√©m quando vamos para um VIF mais detalhado temos que n√£o h√° multicolinearidade entre os fatores.

## Quest√£o B

Escreva as hip√≥teses, decis√£o e conclus√£o do teste F para o modelo. Use o pvalor da sa√≠da do software para o teste. Fa√ßa a interpreta√ß√£o do coeficiente de determina√ß√£o.

```{r}
summary(modelo_completo)
```

### Hip√≥tese:

$$
\left\{ \begin{array}{rc} 
H0: \beta1 = \beta2 = \beta3 = \beta4 = 0 \\ 
H1: pelo \ menos \ um \ \beta \ difere \ de \ zero \\ 
\end{array}\right.
$$

### Conclus√£o

-   Dado que nosso modelo completo possu√≠ p-value: \< 2.2e-16, podemos concluir que h√° qualquer n√≠vel de signific√¢ncia ele rejeita H0, logo pelo menos um beta difere de zero (2.2e-16 \< 0.001). Temos uma F calc de 185.2 o que √© bem expressivo e positivo.
-   Sendo R-squared = 0.673 e Adjusted R-squared = 0.6694, o que relativamente aceitavel j√° que identifica a porcentagem a variabilidade no campo Y (consumo_de_cerveja_litros) que √© explicada pela variaveis regressoras.

## Quest√£o C

Escreva as hip√≥teses, decis√£o e conclus√£o do teste t para todos os par√¢metros do modelo. Decida quais vari√°veis n√£o s√£o importantes neste modelo e porque. Use 5% de signific√¢ncia, e considere a regra do pvalor para decis√£o.

### Hip√≥tese 1:

$$
\left\{ \begin{array}{rc} 
H0: \beta1 = 0 \\ 
H1: \beta1 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ data)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que aceita-se H0 dado que p-value = 0.4069 √© maior que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ1 √© estatisticamente igual a 0, desta forma a vari√°vel data n√£o serve para predizer os valores de y(consumo_de_cerveja_litros).

### Hip√≥tese 2:

$$
\left\{ \begin{array}{rc} 
H0: \beta2 = 0 \\ 
H1: \beta2 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ temperatura_media_c)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que rejeita-se H0 dado que p-value = 2.2e-16 √© menor que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ2 √© estatisticamente diferente de 0, desta forma a vari√°vel temperatura_media_c √© √∫til para predizer os valores de y(consumo_de_cerveja_litros).

### Hip√≥tese 3:

$$
\left\{ \begin{array}{rc} 
H0: \beta3 = 0 \\ 
H1: \beta3 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ precipitacao_mm)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que rejeita-se H0 dado que p-value = 0.0001954 √© menor que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ3 √© estatisticamente diferente de 0, desta forma a vari√°vel precipitacao_mm √© √∫til para predizer os valores de y(consumo_de_cerveja_litros).

### Hip√≥tese 4:

$$
\left\{ \begin{array}{rc} 
H0: \beta4 = 0 \\ 
H1: \beta4 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ final_de_semana)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que rejeita-se H0 dado que p-value = 2.2e-16 √© menor que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ4 √© estatisticamente diferente de 0, desta forma a vari√°vel final_de_semana √© √∫til para predizer os valores de y(consumo_de_cerveja_litros).

## Quest√£o D

Utilize o m√©todo Backward de sele√ß√£o de vari√°veis para encontrar o melhor conjunto de preditoras para essa vari√°vel y. Escreva a equa√ß√£o do modelo ajustado e a interpreta√ß√£o, para todas as vari√°veis que restaram no modelo. Considere 5% de signific√¢ncia. Apresente os valores dos testes em cada passo, com a interpreta√ß√£o.

Modelo completo -\> consumo_de_cerveja_litros \~ data+temperatura_media_c+precipitacao_mm+final_de_semana

### Removendo data

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ 
                       temperatura_media_c+precipitacao_mm+final_de_semana)
anova(modelo_completo,modelo_sem_data)
```

### Removendo temperatura_media_c

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ 
                       data++precipitacao_mm+final_de_semana)
anova(modelo_completo,modelo_sem_data)
```

### Removendo precipitacao_mm

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ 
                       data+temperatura_media_c+final_de_semana)
anova(modelo_completo,modelo_sem_data)
```

### Removendo final_de_semana

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ 
                       data+temperatura_media_c+precipitacao_mm)
anova(modelo_completo,modelo_sem_data)

qf(0.95,1,361)
```

### Conclus√£o:

Dado que nosso menor F calc foi 13.016, devemos compara com F Tab de parametro (0.95,1,361). Logo temos que A 95% de confian√ßa, escolhemos o Fcalc m√≠nimo para comparar com Ftab, Fmin(13.016) \> Ftab(3.867347), nesse casos rejeita-se Ho, e conclui-se que n√£o se pode tirar a vari√°vel data. Ent√£o mant√©m o modelo com modelo completo.

## Quest√£o E

Utilize o m√©todo Forward de sele√ß√£o de vari√°veis para encontrar o melhor conjunto de preditoras para essa vari√°vel y. Escreva a equa√ß√£o do modelo ajustado e compare com o modelo obtido em (d).

Me basendo no F da quest√£o C o melhor modelo reduzido para se come√ßar √©:

```{r}
modelo_reduzido = lm(consumo_de_cerveja_litros ~ temperatura_media_c)
```

### Adicionar data

```{r}
modelo_mais_data = lm(consumo_de_cerveja_litros ~ temperatura_media_c+data)
summary(aov(modelo_mais_data))
anova(modelo_reduzido,modelo_mais_data)
```

### Adicionar precipitacao_mm

```{r}
modelo_mais_precipitacao_mm = lm(consumo_de_cerveja_litros ~ 
                                   temperatura_media_c+precipitacao_mm)
anova(modelo_reduzido,modelo_mais_precipitacao_mm)
```

### Adicionar final_de_semana

```{r}
modelo_mais_final_de_semana = lm(consumo_de_cerveja_litros ~ 
                                   temperatura_media_c+final_de_semana)
anova(modelo_reduzido,modelo_mais_final_de_semana)
```

### Conclus√£o:

O Fmax √© igual 271.64 sendo final_de_semana o mais prov√°vel de ser adicionado.

### Validando a variavel

```{r}
qf(0.95, 1 , 362)
```

#### Conclus√£o:

Fmax(271.64) \> Ftab(3.867275) aceitamos o modelo completo como consumo_de_cerveja_litros \~ temperatura_media_c+final_de_semana

### Novo Modelo Reduzido

```{r}
modelo_reduzido = lm(consumo_de_cerveja_litros ~ 
                       temperatura_media_c+final_de_semana)
```

### Adicionar data

```{r}
modelo_mais_data = lm(consumo_de_cerveja_litros ~ 
                        temperatura_media_c+final_de_semana+data)
summary(aov(modelo_mais_data))
anova(modelo_reduzido,modelo_mais_data)
```

### Adicionar precipitacao_mm

```{r}
modelo_mais_precipitacao_mm = lm(consumo_de_cerveja_litros ~ 
                                temperatura_media_c+final_de_semana+precipitacao_mm)
anova(modelo_reduzido,modelo_mais_precipitacao_mm)
```

### Conclus√£o:

O Fmax √© igual 46.716 sendo precipitacao_mm o mais prov√°vel de ser adicionado.

### Validando a variavel

```{r}
qf(0.95, 1 , 361)
```

#### Conclus√£o:

Fmax(46.716) \> Ftab(3.867347) aceitamos o modelo completo como consumo_de_cerveja_litros \~ temperatura_media_c+final_de_semana+precipitacao_mm

### Novo Modelo Reduzido

```{r}
modelo_reduzido = lm(consumo_de_cerveja_litros ~ 
                       temperatura_media_c+final_de_semana+precipitacao_mm)
```

### Adicionar data

```{r}
modelo_mais_data = lm(consumo_de_cerveja_litros ~ 
                        temperatura_media_c+final_de_semana+precipitacao_mm+data)
summary(aov(modelo_mais_data))
anova(modelo_reduzido,modelo_mais_data)
```

### Conclus√£o:

O Fmax √© igual 13.016 sendo data prov√°vel de ser adicionado.

### Validando a variavel

```{r}
qf(0.95, 1 , 360)
```

#### Conclus√£o:

Fmax(13.016) \> Ftab(3.867419) aceitamos o modelo completo como consumo_de_cerveja_litros \~ temperatura_media_c+final_de_semana+precipitacao_mm+data

### Conclus√£o:

O Modelo da quest√£o D e E chegaram no mesmo resultado.

## Quest√£o F

Escolha um dos modelos ajustados em (d) ou (e) e fa√ßa a an√°lise completa dos res√≠duos do modelo, verificando todas as pressuposi√ß√µes do modelo. Apresente os gr√°ficos dos res√≠duos padronizados contra: y estimado, vari√°veis independentes, ordem das observa√ß√µes. Apresente todas as conclus√µes. Complemente as conclus√µes com os testes de Shapiro Wilk, Durbin Watson. Discuta sobre a necessidade de transforma√ß√£o na vari√°vel resposta, ou de usar m√≠nimos quadrados ponderados, justificando.

```{r}
residuos <- residuals(modelo_completo)
```

### Gr√°fico de Dispers√£o dos Res√≠duos vs. Valores Ajustados

```{r}
plot(modelo_completo$fitted.values, residuos)
```

#### Conclus√µes:

Os pontos distribuem-se de forma aleat√≥ria, indicando assim homocedasticidade e homog√™nea, ou seja, a variabilidade dos res√≠duos √© constante em v√°rios n√≠veis de predi√ß√£o. Se houvesse padr√µes, como um aumento nos res√≠duos √† medida que os valores ajustados aumentam, isso sugeriria a presen√ßa de heterocedasticidade. Tal cen√°rio poderia indicar que o residuo do modelo n√£o possui variabilidade costante.

(Solu√ß√£o: fazer transforma√ß√£o em Y ou usar M√≠nimos Quadrados Ponderados.)

A homocedasticidade √© provavelmente violada se...

1.  Se os res√≠duos aumentam ou diminuem com os valores ajustados.
2.  Se os pontos formam uma curva ao redor de zero e n√£o est√£o dispostos aleatoriamente.
3.  Poucos pontos no gr√°fico ficam muito distantes dos demais.

### Gr√°fico de Dispers√£o dos Res√≠duos vs. Data

```{r}
plot(data, residuos)
```

#### Conclus√µes:

1.  Os res√≠duos se distribuem aleatoriamente em torno de zero.
2.  N√£o se observa nenhum padr√£o.
3.  Isso indica que: a vari√¢ncia √© constante; e a rela√ß√£o entre as vari√°veis √© linear.

### Gr√°fico de Dispers√£o dos Res√≠duos vs. Temperatura_media_c

```{r}
plot(temperatura_media_c, residuos)
```

#### Conclus√µes:

Tem uma leve diferen√ßa entre os valores de 15 a 20 e depois tem uma aumento, pode repesentar uma vari√¢ncia n√£o constante, mas √© necessario realizar mais testes.

1.  Os res√≠duos se distribuem aleatoriamente em torno de zero.
2.  N√£o se observa nenhum padr√£o.
3.  Isso indica que: a vari√¢ncia √© constante; e a rela√ß√£o entre as vari√°veis √© linear.

### Gr√°fico de Dispers√£o dos Res√≠duos vs. precipitacao_mm

```{r}
plot(precipitacao_mm , residuos)
```

Conclus√µes:

Possui uma concentra√ßao no zero e tem uma leve diferen√ßa entre os valores de 0 a 20, em seguida tem uma diminui√ß√£o, pode repesentar uma vari√¢ncia n√£o constante, mas √© necessario realizar mais testes.

1.  Os res√≠duos se distribuem aleatoriamente em torno de zero.
2.  N√£o se observa nenhum padr√£o.
3.  Isso indica que: a vari√¢ncia √© constante; e a rela√ß√£o entre as vari√°veis √© linear.

### Gr√°fico de Dispers√£o dos Res√≠duos vs. final_de_semana

```{r}
plot(final_de_semana , residuos)
```

#### Conclus√µes:

1.  Os res√≠duos se distribuem aleatoriamente em torno de zero.
2.  N√£o se observa nenhum padr√£o.
3.  Isso indica que: a vari√¢ncia √© constante; e a rela√ß√£o entre as vari√°veis √© linear.

# Gr√°fico de dispers√£o dos res√≠duos vs. ordem das observa√ß√µes

```{r}
plot(1:length(residuos), residuos)
```

A dispers√£o aleat√≥ria dos res√≠duos ao longo da ordem das observa√ß√µes mostra que o modelo est√° bem ajustado aos dados. N√£o h√° indica√ß√µes de que o modelo esteja cometendo erros de maneira sistem√°tica ou previs√≠vel.

### Gr√°fico QQ-plots

```{r}
qqnorm(residuos)
qqline(residuos) 
```

#### Conclus√µes:

Podemos ver que os res√≠duos tendem a se desviar um pouco da linha perto das caudas, o que pode indicar que eles n√£o est√£o normalmente distribu√≠dos.

### Teste de normalidade dos res√≠duos (Shapiro-Wilk)

```{r}
shapiro.test(residuos)
```

#### Hip√≥tese:

$$
\left\{ \begin{array}{rc} 
H0: Os \ erros \ t√™m \ distribui√ß√£o \ normal \\ 
H1: Os \ erros \ n√£o \ t√™m \ distribui√ß√£o \ normal \\ 
\end{array}\right.
$$

##### Conclus√µes:

Como resultado, o teste retornar√° a estat√≠stica W, que ter√° um valor de signific√¢ncia associada, o valor-p. Para dizer que uma distribui√ß√£o √© normal, o valor p precisa ser maior do que 0,05. Logo rejeitar a hip√≥tese nula concluimos que os erros n√£o tem distribui√ß√£o normal.

### Teste de autocorrela√ß√£o dos res√≠duos (Durbin-Watson)

```{r}
durbinWatsonTest(modelo_completo)
```

#### Hip√≥tese:

$$
\left\{ \begin{array}{rc} 
H0: ùúå = 0 \\ 
H1: ùúå \neq 0 \\ 
\end{array}\right.
$$

##### Conclus√µes:

Ele faz uma estat√≠stica que testa se eles s√£o independentes. A√≠, o p-valor que a gente compara √© com 0.05, nesse caso, o p-valor n√£o foi menor do que 0.05. Logo, a gente n√£o tem evid√™ncia suficiente para rejeitar a hip√≥tese nula. Se eu n√£o consigo rejeitar √© porque eu n√£o tenho evid√™ncias para dizer que elas n√£o s√£o independentes. Ent√£o, eu aceito que s√£o independentes e n√£o h√° autocorrela√ß√£o significativa.

### Conclus√µes Geral:

√â poss√≠vel que seja necess√°rio transformar a vari√°vel de resposta para abordar a falta de normalidade nos res√≠duos, facilitando assim a aprova√ß√£o no teste de Shapiro-Wilk. No entanto, em rela√ß√£o √† aplica√ß√£o de m√≠nimos quadrados ponderados, a evid√™ncia de falta de homocedasticidade nos res√≠duos n√£o √© conclusiva, necessitando de mais testes.

## Quest√£o G

Realize a an√°lise de diagn√≥stico do modelo, apresentando os gr√°ficos de todas as medidas estudadas (DFFITS, DFBETAS, Dist√¢ncia de Cook, leverage, res√≠duos estudentizados). Interprete cada uma usando o gr√°fico e CALCULE o ponto de corte visto no livro para comparar.

### DFFIT

```{r}
ols_plot_dffits(modelo_completo)
```

#### Conclus√µes:

DFFIT - diferen√ßa nos ajustes, √© usado para identificar pontos de dados influentes. Ele quantifica o n√∫mero de desvios padr√£o que o valor ajustado muda quando o i-√©simo ponto de dados √© omitido.

Pontos ultrapassao a linha podem ser considerados pontos influentes.

### DFBETAS

```{r}
ols_plot_dfbetas(modelo_completo)
```

#### Conclus√µes:

O gr√°fico sugere que v√°rios pontos t√™m uma influ√™ncia consider√°vel na estimativa da inclina√ß√£o para x. Neste caso, a inspe√ß√£o visual da rela√ß√£o linear entre x e y √© poss√≠vel. O painel mostra a influ√™ncia de cada observa√ß√£o nas estimativas dos quatro coeficientes de regress√£o. As estat√≠sticas s√£o padronizadas para que todos os gr√°ficos possam utilizar a mesma escala vertical. As linhas horizontais s√£o desenhadas em ¬±2/sqrt(n). As observa√ß√µes s√£o chamadas de influentes se tiverem uma estat√≠stica DFBETA que exceda esse valor.

### Cook's distance

```{r}
ols_plot_cooksd_chart(modelo_completo)
```

#### Conclus√µes:

Gr√°fico de barras da dist√¢ncia de Cook para detectar observa√ß√µes que influenciam fortemente os valores ajustados do modelo. A dist√¢ncia de Cook foi introduzida pelo estat√≠stico americano R Dennis Cook em 1977. √â usada para identificar pontos de dados influentes. Depende tanto do res√≠duo quanto da alavancagem, ou seja, leva em considera√ß√£o tanto o valor x quanto o valor y da observa√ß√£o. Passos para calcular a dist√¢ncia de Cook:

-   exclua as observa√ß√µes uma de cada vez.
-   reajuste o modelo de regress√£o no restante (n‚àí1) observa√ß√µes
-   examine quanto todos os valores ajustados mudam quando a i-√©sima observa√ß√£o √© exclu√≠da.

Um ponto de dados com dist√¢ncia Cook grande indica que o ponto de dados influencia fortemente os valores ajustados.

### Studentized Residuals vs Leverage Plot

```{r}
ols_plot_resid_lev(modelo_completo)
```

#### Conclus√µes:

Gr√°fico para detec√ß√£o de outliers e/ou observa√ß√µes com alta influencia

### Res√≠duos Studentizados

```{r}
ols_plot_resid_stud(modelo_completo)
```

#### Conclus√µes:

Gr√°fico para detec√ß√£o de outliers. Res√≠duos exclu√≠dos estudantis (ou res√≠duos estudantis externamente) s√£o os res√≠duos exclu√≠dos divididos por seu desvio padr√£o estimado. Os res√≠duos estudantis ser√£o mais eficazes para detectar observa√ß√µes Y perif√©ricas do que os res√≠duos padronizados. Se uma observa√ß√£o tiver um res√≠duo estudantil externamente maior que 3 (em valor absoluto), podemos cham√°-la de outlier.

# Regress√£o Log√≠stica

## Quest√£o A

Escreva a equa√ß√£o do modelo ajustado, capaz de descrever o relacionamento existente entre a ocorr√™ncia de sinistro e as vari√°veis em estudo.

```{r}
sinistro <- read.delim("dados/dadosSinistro.txt")
```

```{r}
modelo=glm(Sinistro~Idade+ECivil+Sexo,data = sinistro,
           family=binomial(link="logit"))
summary(modelo)
```

## Quest√£o B

Explicar o significado de cada componente do modelo; 

#### Conclus√µes:

beta 1 = - 0.19 o log da raz√£o de chances diminui em 0.19 quando seaumenta uma unidade na vari√°vel idade e mant√©m as demais vari√°veisconstantes. A estimativa negativa de Beta1 indica que aumentando-se avari√°vel idade, diminui-se a chance de sucesso (sinistro)
Beta2 = -3,62: diminui√ß√£o no log da raz√£o de chances quando se muda oestado civil de casado para solteiro.
Beta3 = 3,70: aumento no log da raz√£o de chances quando se muda dosexo masculino para o feminino. A estimativa positiva de Beta3 indica queo sexo codificado como 1, tem maior chance de sucesso (sinistro) quandocomparado com o estado codificado como zero.

O modelo apresenta Pr(\>\|z\|) √© menos que o n√≠vel signific√¢ncia de 0.05. Logo os par√¢metros s√£o significativos. O modelo possui um Intercepto positivo o que siginifica que ele tem uma curva crescente.

O AIC estima a quantidade relativa de informa√ß√£o perdida por um determinado modelo: quanto menos informa√ß√µes um modelo perde, maior a qualidade desse modelo e menor a pontua√ß√£o AIC.

## Quest√£o C

Teste a signific√¢ncia do modelo por meio do Teste de raz√£o de verossimilhan√ßa, apresentando as hip√≥teses e conclus√£o. Teste a signific√¢ncia dos par√¢metros do modelo e apresente as conclus√µes, em termos das vari√°veis. Use 1% de signific√¢ncia.

```{r}
paste0('TRV = ',modelo[["null.deviance"]]-modelo[["deviance"]],' e ', 
       qchisq(0.99,3), ' h√° 95% e 3p')
```

#### Conclus√µes:

Dado que o TRV √© maior que qui quadrado h√° 99% e com 3 parametros o modelo como um todo √© significativo, rejeitamos h0.

Lembrando:

Considere dois modelos um "completo" (Mc ) e o outro "restrito" (Mr) quanto √† quantidade de par√¢metros.Ent√£o a estat√≠stica de teste √©:

TRV = 2 [log(L(Mc )) ‚àí log(L(Mr))].

$$
\left\{ \begin{array}{rc} 
H0: Igualdade \ entre \ os \ dois \ modelos \\ 
H1: Difern√ßa \ entre \ os \ dois \ modelos \\ 
\end{array}\right.
$$

Sob a hip√≥otese de igualdade entre os dois modelos, TRV tem distribui√ß√£o aproximada de Qui-Quadrado com graus de liberdade igual ao n√∫mero de restri√ß√µes (diferen√ßa entre as quantidades de par√¢metros).

## Quest√£o D

Interprete as raz√µes de chance e os intervalos de confian√ßa obtidas para todos os par√¢metros;

### Intervalos de confian√ßa

```{r}
ICbeta=confint.default(modelo,level=0.95)
ICbeta

```

#### Conclus√µes:

Isso significa que voc√™ tem 95% de confian√ßa de que a verdadeiro valor de beta/intercepto esteja entre os valores acima. O valor zero pertence ao intervalo, logo os par√¢metros de beta sao estatisticamente igual a zero.

### odds ratio -- OR (chance)

```{r}
OR=exp(modelo$coefficients)
OR
```

#### Conclus√µes:

A chance de haver sinistro(1) √© de cerca de 0.83 vezes menos para cada ano de acrescentado na idade, ou seja, as chances de a haver sinistro √© de 17% menor a cada ano de acrescentado na idade; A chance de haver sinistro(1) √© de cerca de 0.027 vezes menos quando estado civil igual a Solteiro(1), ou seja, as chances de a haver sinistro √© de 97.3% menor se for Solteiro; A chance de haver sinistro(1) √© de cerca de 40.55 vezes maior se o sexo for Feminino(1).

Odds 1 = 0.83 representa a diminui√ß√£o na chance de sinistro quando seaumenta uma unidade na idade. A chance de sinistro diminui cerca de17 % (1-0,83) quando se aumenta um ano na idade e mant√©m as demaisvari√°veis constantes.
Odds2 = 0.027 representa a diminui√ß√£o na chance de sinistro de umindividuo solteiro, em compara√ß√£o com um casado. Portanto, o indiv√≠duosolteiro tem cerca de 98% (1-0,027) menos chances de sinistro do que umcasado
Odds3 = 40,55 representa o aumento na chance de sinistro quando oindiv√≠duo √© feminino. Assim, o feminino tem 40 vezes mais chance desinistro do que o masculino


### Intervalos de confian√ßa para as raz√µes de chance

```{r}
ICOR=exp(ICbeta);
round((cbind(OR, ICOR)),3)
```

#### Conclus√µes:

Isso significa que voc√™ tem 95% de confian√ßa de que a verdadeiro valor de odds ratio esteja entre os valores acima. J√° que 1 n√£o pertence ao intevalo, logo a chance de sucesso para os dois grupos sob compara√ß√£o √© diferente.

Quando o intervalo de confian√ßa da raz√£o de chances inclui o valor 1, significa que estatisticamente a raz√£o de chances vale 1, ou seja, a chance de sucesso para os dois grupos sob compara√ß√£o √© a mesma.  Se o IC para OR inclui o 1, no caso do sexo, significa que a chance de sucesso para masculino √© a mesma que para o feminino. 

## Quest√£o E

Estime a probabilidade de sinistro associada a um cliente do sexo masculino, casado com 25 anos de idade

```{r}

p_sexo = 0
p_ec = 0
p_idade = 25

razaopiest = exp(modelo[["coefficients"]]['(Intercept)'][[1]] + 
                 (modelo[["coefficients"]]['Idade'][[1]] * p_idade) +
                 (modelo[["coefficients"]]['ECivil'][[1]] * p_ec) +
                 (modelo[["coefficients"]]['Sexo'][[1]] * p_sexo)
                 )

paste0('Estima√ß√£o da probabilidade de sinistro = ',
       (razaopiest /(1 + razaopiest)))
```

## Quest√£o F

Para o mesmo cliente citado no item anterior, qual a probabilidade de sinistro se ele for solteiro?

```{r}

p_sexo = 0
p_ec = 1
p_idade = 25

razaopiest = exp(modelo[["coefficients"]]['(Intercept)'][[1]] + 
                 (modelo[["coefficients"]]['Idade'][[1]] * p_idade) +
                 (modelo[["coefficients"]]['ECivil'][[1]] * p_ec) +
                 (modelo[["coefficients"]]['Sexo'][[1]] * p_sexo)
                 )

paste0('Estima√ß√£o da probabilidade de sinistro = ',
       (razaopiest /(1 + razaopiest)))
```

## Quest√£o G

Compare os resultados obtidos nos dois itens anteriores e reflita sobre as estrat√©gias que poderiam ser adotadas pela companhia para atrair novos clientes.

#### Conclus√µes:

Com base na estima√ß√£o anterioir e para os parametros colocados a prova podemos dizer que para a companhia seria benefico focar em atrai solteiros dados que a chance de haver sinistro diminui muito.

## Quest√£o H

Considere um n√≠vel de signific√¢ncia de 1% para excluir vari√°veis do modelo e comparar o modelo reduzido com o modelo completo, usando o teste de raz√£o de verossimilhan√ßa. Decida qual o melhor modelo, com base nesse teste.

```{r}

modelo=glm(Sinistro~Idade+ECivil+Sexo,data = sinistro,
           family=binomial(link="logit"))
summary(modelo)

deviance_completo = modelo[["deviance"]]

modelo=glm(Sinistro~Idade,data = sinistro,
           family=binomial(link="logit"))
summary(modelo)

deviance_idade = modelo[["deviance"]]

paste0('TRV = ',deviance_idade-deviance_completo,' e ', 
       qchisq(0.99,2), ' h√° 99% e 4-2=2p')

```

#### Conclus√µes:

Dado que o TRV √© maior que qui quadrado h√° 99% e com 2 parametros, temos que o modelo com ECivil+Sexo(completo) como um todo √© significativo. Rejeitamos h0.

Lembrando:



$$
\left\{ \begin{array}{lc} 
H0:  Modelo \ s√≥ \ com \ 1 \ vari√°vel (X1) \ √© \ melhor \ que \ o \ modelo \ com \ 3 \\
\ \ \ \ \ \ \ \ \ vari√°veis(ou \ seja, \ a \ contribui√ß√£o \ de \ X2 \ e \ X3 \ n√£o \ √© \ significativa) \\ 
H1:  Modelo \ completo \ √© \ melhor \ que \ o \ reduzido \\ 
\end{array}\right.
$$

Sob a hip√≥otese de igualdade entre os dois modelos, TRV tem distribui√ß√£o aproximada de Qui-Quadrado com graus de liberdade igual ao n√∫mero de restri√ß√µes (diferen√ßa entre as quantidades de par√¢metros).

Quanto mais elevada a diferen√ßa entre os dois valores, maioro potencial dos coeficientes para estimar probabilidadesassociadas a ocorr√™ncia de determinado evento.

Essa diferen√ßa serve para testar a hip√≥tese de que todos oscoeficientes do modelo log√≠stico s√£o iguais a zero, tal como severifica na distribui√ß√£o F.
