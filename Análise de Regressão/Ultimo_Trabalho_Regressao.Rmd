---
title: "Ultimo Trabalho Regressao"
author: "Bruno Mesquita dos Santos"
date: "2023-11-15"
output:
  word_document: default
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Biblioteca

```{r}
if (!require('readr'))install.packages("readr");library(readr)
if (!require('faraway'))install.packages("faraway");library(faraway)
if (!require('car'))install.packages("car");library(car)
```

# Dados Consumo Cerveja

```{r}
Consumo_cerveja <- read_csv("dados/Consumo_cerveja.csv",   
                            locale = locale(decimal_mark = ","))
```

# Fun√ß√µes

```{r}
rm_accent <- function(x) iconv(x, to = "ASCII//TRANSLIT")
```

# Limpeza

```{r}
names(Consumo_cerveja) <- tolower(
  gsub(' ','_',gsub('[)]','',gsub('[(]','',rm_accent(names(Consumo_cerveja)))))
  )
Consumo_cerveja <- na.omit(Consumo_cerveja)
```

# Separar Bases

```{r}
data <- Consumo_cerveja$data
temperatura_media_c <- Consumo_cerveja$temperatura_media_c
temperatura_minima_c <- Consumo_cerveja$temperatura_minima_c
temperatura_maxima_c <- Consumo_cerveja$temperatura_maxima_c
precipitacao_mm <- Consumo_cerveja$precipitacao_mm
final_de_semana <- Consumo_cerveja$final_de_semana
consumo_de_cerveja_litros <- Consumo_cerveja$consumo_de_cerveja_litros
```

# An√°lise de Regress√£o

## Quest√£o A

Ajuste um modelo de regress√£o linear m√∫ltipla considerando todas as vari√°veis independentes. Verifique a multicolinearidade entre as vari√°veis independentes, e se h√° necessidade de excluir alguma delas por esse crit√©rio. Em caso afirmativo, ajuste novo modelo sem essa vari√°vel. Apresente todos os valores de Vif.

```{r}
modelo_completo = lm(consumo_de_cerveja_litros ~ data+temperatura_media_c+
                       temperatura_minima_c+temperatura_maxima_c+
                       precipitacao_mm+final_de_semana)

summary(modelo_completo)
summary(aov(modelo_completo))
```

### Anotac√£o:

Se o VIF for igual a 1 n√£o h√° multicolinearidade entre os fatores, mas se o VIF for maior que 1, as preditoras podem estar moderadamente correlacionadas. A sa√≠da acima mostra que o VIF para os fatores de publica√ß√£o e anos s√£o cerca de 1.5, o que indica alguma correla√ß√£o, mas n√£o o suficiente para se preocupar demais com isso. Um VIF entre 5 e 10 indica alta correla√ß√£o, o que pode ser problem√°tico. E se o VIF for acima de 10, voc√™ pode assumir que os coeficientes de regress√£o est√£o mal estimados devido √† multicolinearidade.

### VIF:

```{r}
vif <- 1/(1-summary(modelo_completo)[["r.squared"]])
paste('vif =',vif)
```

Com rela√ß√£o ao nosso modelo temos um VIF para o modelo completo de 3.7254 o que quer dizer que ele √© moderadamente correlacionadas.

```{r}
vif(modelo_completo)
```

Por√©m quando vamos para um VIF mais detalhado temos em temperatura_media_c, temperatura_minima_c, temperatura_maxima_c uma multicolinearidade alto, o que faz sentido devido serem dados de temperaturas tendo a mesmas representatividade, logo removeria dois ficando √© com a temperatura_media_c.

### Removendo a multicolinearidade

```{r}
modelo_completo = lm(consumo_de_cerveja_litros ~ data+temperatura_media_c+
                       precipitacao_mm+final_de_semana)

summary(modelo_completo)
summary(aov(modelo_completo))
```

### Conclus√£o:

```{r}
vif <- 1/(1-summary(modelo_completo)[["r.squared"]])
paste('vif =',vif)
```

Com rela√ß√£o ao nosso modelo temos um VIF para o modelo completo de 3.058 o que quer dizer que ele √© moderadamente correlacionadas.

```{r}
vif(modelo_completo)
```

Por√©m quando vamos para um VIF mais detalhado temos que n√£o h√° multicolinearidade entre os fatores.

## Quest√£o B

Escreva as hip√≥teses, decis√£o e conclus√£o do teste F para o modelo. Use o pvalor da sa√≠da do software para o teste. Fa√ßa a interpreta√ß√£o do coeficiente de determina√ß√£o.

```{r}
summary(modelo_completo)
```

### Hip√≥tese:

$$
\left\{ \begin{array}{rc} 
H0: \beta1 = \beta2 = \beta3 = \beta4 = 0 \\ 
H1: pelo \ menos \ um \ \beta \ difere \ de \ zero \\ 
\end{array}\right.
$$

### Conclus√£o

-   Dado que nosso modelo completo possu√≠ p-value: \< 2.2e-16, podemos concluir que h√° qualquer n√≠vel de signific√¢ncia ele rejeita H0, logo pelo menos um beta difere de zero (2.2e-16 \< 0.001). Temos uma F calc de 185.2 o que √© bem expressivo e positivo.
-   Sendo R-squared = 0.673 e Adjusted R-squared = 0.6694, o que relativamente aceitavel j√° que identifica a porcentagem a variabilidade no campo Y (consumo_de_cerveja_litros) que √© explicada pela variaveis regressoras.

## Quest√£o C

Escreva as hip√≥teses, decis√£o e conclus√£o do teste t para todos os par√¢metros do modelo. Decida quais vari√°veis n√£o s√£o importantes neste modelo e porque. Use 5% de signific√¢ncia, e considere a regra do pvalor para decis√£o.

### Hip√≥tese 1:

$$
\left\{ \begin{array}{rc} 
H0: \beta1 = 0 \\ 
H1: \beta1 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ data)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que aceita-se H0 dado que p-value = 0.4069 √© maior que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ1 √© estatisticamente igual a 0, desta forma a vari√°vel data n√£o serve para predizer os valores de y(consumo_de_cerveja_litros).

### Hip√≥tese 2:

$$
\left\{ \begin{array}{rc} 
H0: \beta2 = 0 \\ 
H1: \beta2 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ temperatura_media_c)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que rejeita-se H0 dado que p-value = 2.2e-16 √© menor que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ2 √© estatisticamente diferente de 0, desta forma a vari√°vel temperatura_media_c √© √∫til para predizer os valores de y(consumo_de_cerveja_litros).

### Hip√≥tese 3:

$$
\left\{ \begin{array}{rc} 
H0: \beta3 = 0 \\ 
H1: \beta3 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ precipitacao_mm)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que rejeita-se H0 dado que p-value = 0.0001954 √© menor que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ3 √© estatisticamente diferente de 0, desta forma a vari√°vel precipitacao_mm √© √∫til para predizer os valores de y(consumo_de_cerveja_litros).

### Hip√≥tese 4:

$$
\left\{ \begin{array}{rc} 
H0: \beta4 = 0 \\ 
H1: \beta4 \neq 0 \\ 
\end{array}\right.
$$

```{r}
modelo_uma_var = lm(consumo_de_cerveja_litros ~ final_de_semana)
summary(modelo_uma_var)
```

Concluimos a um n√≠vel de 5% de signific√¢ncia que rejeita-se H0 dado que p-value = 2.2e-16 √© menor que o n√≠vel signific√¢ncia de 0.05. Logo o coeficiente angular ùõΩ4 √© estatisticamente diferente de 0, desta forma a vari√°vel final_de_semana √© √∫til para predizer os valores de y(consumo_de_cerveja_litros).

## Quest√£o D

Utilize o m√©todo Backward de sele√ß√£o de vari√°veis para encontrar o melhor conjunto de preditoras para essa vari√°vel y. Escreva a equa√ß√£o do modelo ajustado e a interpreta√ß√£o, para todas as vari√°veis que restaram no modelo. Considere 5% de signific√¢ncia. Apresente os valores dos testes em cada passo, com a interpreta√ß√£o.

Modelo completo -\> consumo_de_cerveja_litros \~ data+temperatura_media_c+precipitacao_mm+final_de_semana

### Removendo data

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ temperatura_media_c+precipitacao_mm+final_de_semana)
anova(modelo_completo,modelo_sem_data)
```

### Removendo temperatura_media_c

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ data++precipitacao_mm+final_de_semana)
anova(modelo_completo,modelo_sem_data)
```

### Removendo precipitacao_mm

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ data+temperatura_media_c+final_de_semana)
anova(modelo_completo,modelo_sem_data)
```

### Removendo final_de_semana

```{r}
modelo_sem_data = lm(consumo_de_cerveja_litros ~ data+temperatura_media_c+precipitacao_mm)
anova(modelo_completo,modelo_sem_data)

qf(0.95,1,361)
```

### Conclus√£o:

Dado que nosso menor F calc foi 13.016, devemos compara com F Tab de parametro (0.95,1,361). Logo temos que A 95% de confian√ßa, escolhemos o Fcalc m√≠nimo para comparar com Ftab, Fmin(13.016) \> Ftab(3.867347), nesse casos rejeita-se Ho, e conclui-se que n√£o se pode tirar a vari√°vel data. Ent√£o mant√©m o modelo com modelo completo.

## Quest√£o E

Utilize o m√©todo Forward de sele√ß√£o de vari√°veis para encontrar o melhor conjunto de preditoras para essa vari√°vel y. Escreva a equa√ß√£o do modelo ajustado e compare com o modelo obtido em (d).

Me basendo no F da quest√£o C o melhor modelo reduzido para se come√ßar √©:

```{r}
modelo_reduzido = lm(consumo_de_cerveja_litros ~ temperatura_media_c)
```

### Adicionar data

```{r}
modelo_mais_data = lm(consumo_de_cerveja_litros ~ temperatura_media_c+data)
summary(aov(modelo_mais_data))
anova(modelo_reduzido,modelo_mais_data)
```

### Adicionar precipitacao_mm

```{r}
modelo_mais_precipitacao_mm = lm(consumo_de_cerveja_litros ~ temperatura_media_c+precipitacao_mm)
anova(modelo_reduzido,modelo_mais_precipitacao_mm)
```

### Adicionar final_de_semana

```{r}
modelo_mais_final_de_semana = lm(consumo_de_cerveja_litros ~ temperatura_media_c+final_de_semana)
anova(modelo_reduzido,modelo_mais_final_de_semana)
```

### Conclus√£o:

O Fmax √© igual 271.64 sendo final_de_semana o mais prov√°vel de ser adicionado.

### Validando a variavel

```{r}
qf(0.95, 1 , 362)
```

####Conclus√£o: Fmax(271.64) \> Ftab(3.867275) aceitamos o modelo completo como consumo_de_cerveja_litros \~ temperatura_media_c+final_de_semana

### Novo Modelo Reduzido

```{r}
modelo_reduzido = lm(consumo_de_cerveja_litros ~ temperatura_media_c+final_de_semana)
```

### Adicionar data

```{r}
modelo_mais_data = lm(consumo_de_cerveja_litros ~ temperatura_media_c+final_de_semana+data)
summary(aov(modelo_mais_data))
anova(modelo_reduzido,modelo_mais_data)
```

### Adicionar precipitacao_mm

```{r}
modelo_mais_precipitacao_mm = lm(consumo_de_cerveja_litros ~ temperatura_media_c+final_de_semana+precipitacao_mm)
anova(modelo_reduzido,modelo_mais_precipitacao_mm)
```

### Conclus√£o:

O Fmax √© igual 46.716 sendo precipitacao_mm o mais prov√°vel de ser adicionado.

### Validando a variavel

```{r}
qf(0.95, 1 , 361)
```

####Conclus√£o: Fmax(46.716) \> Ftab(3.867347) aceitamos o modelo completo como consumo_de_cerveja_litros \~ temperatura_media_c+final_de_semana+precipitacao_mm

### Novo Modelo Reduzido

```{r}
modelo_reduzido = lm(consumo_de_cerveja_litros ~ temperatura_media_c+final_de_semana+precipitacao_mm)
```

### Adicionar data

```{r}
modelo_mais_data = lm(consumo_de_cerveja_litros ~ temperatura_media_c+final_de_semana+precipitacao_mm+data)
summary(aov(modelo_mais_data))
anova(modelo_reduzido,modelo_mais_data)
```

### Conclus√£o:

O Fmax √© igual 13.016 sendo data prov√°vel de ser adicionado.

### Validando a variavel

```{r}
qf(0.95, 1 , 360)
```

#### Conclus√£o:

Fmax(13.016) \> Ftab(3.867419) aceitamos o modelo completo como consumo_de_cerveja_litros \~ temperatura_media_c+final_de_semana+precipitacao_mm+data

### Conclus√£o:

O Modelo da quest√£o D e E chegaram no mesmo resultado.

## Quest√£o F
Escolha um dos modelos ajustados em (d) ou (e) e fa√ßa a an√°lise completa dos res√≠duos
do modelo, verificando todas as pressuposi√ß√µes do modelo. Apresente os gr√°ficos dos
res√≠duos padronizados contra: y estimado, vari√°veis independentes, ordem das
observa√ß√µes. Apresente todas as conclus√µes. Complemente as conclus√µes com os testes
de Shapiro Wilk, Durbin Watson. Discuta sobre a necessidade de transforma√ß√£o na
vari√°vel resposta, ou de usar m√≠nimos quadrados ponderados, justificando. 


```{r}
residuos <- residuals(modelo_completo)
```

### Gr√°fico de Dispers√£o dos Res√≠duos vs. Valores Ajustados
```{r}
plot(modelo_completo$fitted.values, residuos)
```
Os pontos se distribuem de maneira aleat√≥ria, logo a variabilidade dos res√≠duos √© constante em diferentes n√≠veis de predi√ß√£o (homocedasticidade).
Caso houvesse padr√µes (ex.: os res√≠duos aumentando √† medida que os valores ajustados aumentam), isso indicaria a presen√ßa de heterocedasticidade, o que poderia sugerir que o modelo n√£o est√° capturando toda a variabilidade nos dados.

```{r}
plot(data, residuos)
```
```{r}
plot(temperatura_media_c, residuos)
```
```{r}
plot(precipitacao_mm , residuos)
```
```{r}
plot(final_de_semana , residuos)
```
```{r}
plot(1:length(residuos), residuos)
```
```{r}
shapiro.test(residuos)
```
```{r}
durbinWatsonTest(modelo_completo)
```








